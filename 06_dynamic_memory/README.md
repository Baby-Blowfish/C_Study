# ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬
> ëŸ°íƒ€ì„ì— í™ì—ì„œ ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬

> í• ë‹¹, ì •ì , ìë™ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„

> í• ë‹¹ ë° í•´ì œ, ì˜¤ë¥˜ ë°©ì§€ ì „ëµ

## ìŠ¤í† ë¦¬ì§€ ê¸°ê°„

> ê°œì²´ëŠ” RAM, ROM, ë ˆì§€ìŠ¤í„° ë“±ì˜ ìŠ¤í† ë¦¬ì§€ë¥¼ ì°¨ì§€í•¨

- `ìë™ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„` : ê°œì²´ëŠ” ë¸”ë¡ ë‚´ë¶€ë‚˜ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì„ ì–¸, ê°œì²´ì˜ ìˆ˜ëª…ì€ ê°œì²´ë¥¼ ì„ ì–¸í•œ ë¸”ë¡ì´ ì‹¤í–‰ ë ë•Œë¶€í„° ëë‚  ë•Œ ê¹Œì§€, ë¸”ë¡ì´ ì¬ê·€ì ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ë§¤ë²ˆ ìƒˆ ê°œì²´ê°€ ë§Œë“¤ì–´ì§€ê³  ê° ê°œì²´ëŠ” ê³ ìœ í•œ ìŠ¤í† ë¦¬ì§€ë¥¼ ê°–ëŠ”ë‹¤.

- `ì •ì  ìŠ¤í† ë¦¬ì§€ ê¸°ê°„` : íŒŒì¼ ë²”ìœ„ ì•ˆì—ì„œ ì„ ì–¸ëœ ê°œì²´, í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ìœ ì§€, í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ê¸° ì „ì— ì´ˆê¸°í™”

> ì—¬ê¸°ì„œëŠ” `í• ë‹¹ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„`ì— ëŒ€í•´ì„œ ì„¤ëª…í•œë‹¤.

  ### í™ê³¼ ë©”ëª¨ë¦¬ ê´€ë¦¬ì
  `í• ë‹¹ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„` : ë™ì ìœ¼ë¡œ í• ë­ëœ ë©”ëª¨ë¦¬, ìˆ˜ëª…ì€ í• ë‹¹ë¶€í„° í•´ì œë  ë•Œê¹Œì§€, ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ëŠ” ë©”ëª¨ë¦¬ ê´€ë¦¬ìì— ì˜í•´ ë©”ëª¨ë¦¬ ë¸”ë¡ì¸ í™(heap)ì— í• ë‹¹
  - ë©”ëª¨ë¦¬ ê´€ë¦¬ì : í‘œì¤€ ë©”ëª¨ë¦¬ ê´€ë¦¬ í•¨ìˆ˜ì˜ êµ¬í˜„í•´ í™ì„ ê´€ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

  ### ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
  - ëŸ°íƒ€ì„ ì „ì— í”„ë¡œê·¸ë¨ì˜ ì •í™•í•œ ìŠ¤í† ë¦¬ì§€ ìš”êµ¬ ì‚¬í•­ì„ ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° ì‚¬ìš©
  - ë©”ëª¨ë¦¬ ê´€ë¼ì§€ê°€ ëŸ°íƒ€ì„ í™ì—ì„œ ì ì ˆí•œ í¬ê¸°ì˜ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ì°¾ì€ ë‹¤ìŒ í˜¸ì¶œìê°€ í•„ìš”ë¡œ í•˜ì§€ ì•Šì„ ë•Œ ì´ ë¸”ë¡ì„ ëª…ì‹œì ìœ¼ë¡œ í•´ì œí•´ì•¼í•˜ë¯€ë¡œ ì •ì  í• ë‹¹ë³´ë‹¤ íš¨ìœ¨ì ì´ì§€ ì•Šë‹¤.
  ### í™ê³¼ ë©”ëª¨ë¦¬ ê´€ë¦¬ì
  `í• ë‹¹ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„` : ë™ì ìœ¼ë¡œ í• ë­ëœ ë©”ëª¨ë¦¬, ìˆ˜ëª…ì€ í• ë‹¹ë¶€í„° í•´ì œë  ë•Œê¹Œì§€, ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ëŠ” ë©”ëª¨ë¦¬ ê´€ë¦¬ìì— ì˜í•´ ë©”ëª¨ë¦¬ ë¸”ë¡ì¸ í™(heap)ì— í• ë‹¹
  - ë©”ëª¨ë¦¬ ê´€ë¦¬ì : í‘œì¤€ ë©”ëª¨ë¦¬ ê´€ë¦¬ í•¨ìˆ˜ì˜ êµ¬í˜„í•´ í™ì„ ê´€ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

  ### í™ê³¼ ë©”ëª¨ë¦¬ ê´€ë¦¬ì
  `í• ë‹¹ ìŠ¤í† ë¦¬ì§€ ê¸°ê°„` : ë™ì ìœ¼ë¡œ í• ë­ëœ ë©”ëª¨ë¦¬, ìˆ˜ëª…ì€ í• ë‹¹ë¶€í„° í•´ì œë  ë•Œê¹Œì§€, ë™ì ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ëŠ” ë©”ëª¨ë¦¬ ê´€ë¦¬ìì— ì˜í•´ ë©”ëª¨ë¦¬ ë¸”ë¡ì¸ í™(heap)ì— í• ë‹¹
  - ë©”ëª¨ë¦¬ ê´€ë¦¬ì : í™ ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë˜ëŠ” ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸

    - Cì—ì„œ ì œê³µí•˜ëŠ” í‘œì¤€ ë©”ëª¨ë¦¬ ê´€ë¦¬ í•¨ìˆ˜:

      malloc(size) : ì§€ì •ëœ í¬ê¸°ì˜ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ í™ì—ì„œ í• ë‹¹

      calloc(n, size) : 0ìœ¼ë¡œ ì´ˆê¸°í™”ëœ nê°œì˜ ë©”ëª¨ë¦¬ ë¸”ë¡ í• ë‹¹

      realloc(ptr, size) : ê¸°ì¡´ ë©”ëª¨ë¦¬ ë¸”ë¡ í¬ê¸° ë³€ê²½

      free(ptr) : ì´ì „ì— í• ë‹¹ëœ ë©”ëª¨ë¦¬ ë¸”ë¡ í•´ì œ

    ì´ í•¨ìˆ˜ë“¤ì˜ ë‚´ë¶€ êµ¬í˜„ì€ ìš´ì˜ì²´ì œì˜ **ì‹œìŠ¤í…œ ì½œ(mmap, brk)**ê³¼ ì—°ë™ë˜ë©°, **í™ í’€(heap pool)**ì—ì„œ ë¹ˆ ê³µê°„ì„ ì°¾ê³  ì ì ˆíˆ ì¬ì‚¬ìš©/ë³‘í•©/ë¶„í• 

  - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ (Memory Leak)
    > **ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬**ê°€ í•´ì œë˜ì§€ ì•Šê³  ë‚¨ì•„ ìˆëŠ” í˜„ìƒ.  
    > ì¦‰, **`malloc()` ë“±ìœ¼ë¡œ í• ë‹¹ì€ ë˜ì—ˆì§€ë§Œ, `free()`ë¥¼ í•˜ì§€ ì•Šì•„ì„œ ë©”ëª¨ë¦¬ ê´€ë¦¬ìì—ê²Œ ë°˜í™˜ë˜ì§€ ì•Šì€ ìƒíƒœ**
    - ëˆ„ìˆ˜ê°€ ë°˜ë³µë˜ë©´ í™ì— ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ê°€ ì ì  ì¤„ì–´ë“¤ê³ 
    - ê²°êµ­ **ë©”ëª¨ë¦¬ ê³ ê°ˆ â†’ í”„ë¡œê·¸ë¨ì´ ë” ì´ìƒ ë©”ëª¨ë¦¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•¨**
    - íŠ¹íˆ ì„œë²„, ì„ë² ë””ë“œ, ë°˜ë³µ ì‹¤í–‰ë˜ëŠ” ë£¨í”„ì—ì„œëŠ” **ì‹¬ê°í•œ ë²„ê·¸**ê°€ ë  ìˆ˜ ìˆìŒ

  - ì¡°ê° ëª¨ìŒ (Defragmentation)
    > **ë©”ëª¨ë¦¬ í• ë‹¹/í•´ì œ ê³¼ì •ì—ì„œ ìƒê¸´ "ì‘ì€ ë¹ˆí‹ˆ(ì¡°ê°)"ë“¤ì„ ëª¨ì•„ì„œ í° ë¸”ë¡ìœ¼ë¡œ ë§Œë“œëŠ” ì‘ì—…**
    ```text
    [ 200B ì‚¬ìš© ][ 50B ììœ  ][ 300B ì‚¬ìš© ][ 70B ììœ  ][ 100B ì‚¬ìš© ]
    ```
    - ìœ„ êµ¬ì¡°ì—ì„œ ì´ 120Bì˜ ììœ  ê³µê°„ì´ ìˆì§€ë§Œ,  
      **ì¸ì ‘í•˜ì§€ ì•Šì•„ì„œ 100B ì´ìƒ ì—°ì† í• ë‹¹ ë¶ˆê°€**í•  ìˆ˜ ìˆìŒ.
    - ì¡°ê°ë‚œ ìƒíƒœì—ì„œëŠ” **ì¶©ë¶„í•œ ì´ ë©”ëª¨ë¦¬ê°€ ìˆì–´ë„**  
      í° ë¸”ë¡ì„ ìœ„í•œ **ì—°ì†ëœ ê³µê°„ì´ ì—†ì–´ í• ë‹¹ ì‹¤íŒ¨**í•  ìˆ˜ ìˆìŒ
    - ê·¸ë˜ì„œ ì¼ë¶€ ê³ ê¸‰ ë©”ëª¨ë¦¬ ê´€ë¦¬ìëŠ” **ì¸ì ‘í•œ ë¹ˆ ê³µê°„ì„ ë³‘í•©**í•´ì„œ  
      í° ê³µê°„ì„ í™•ë³´í•˜ë ¤ê³  í•¨ â†’ **ì¡°ê° ëª¨ìŒ(Defragmentation)**
    - ì¡°ê° ëª¨ìŒ ìˆ˜í–‰ ì˜ˆì‹œ
      ```text
      Before:
      [ 100B ì‚¬ìš© ][ 50B ììœ  ][ 150B ììœ  ][ 200B ì‚¬ìš© ]

      After Defragmentation:
      [ 100B ì‚¬ìš© ][ 200B ììœ  ][ 200B ì‚¬ìš© ]
      ```
## ë©”ëª¨ë¦¬ ê´€ë¦¬ í•¨ìˆ˜

  | í•¨ìˆ˜ëª…           | ì„¤ëª… |
  |------------------|------|
  | `malloc()`       | ì›í•˜ëŠ” ë°”ì´íŠ¸ ìˆ˜ë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ **í• ë‹¹** |
  | `calloc()`       | 0ìœ¼ë¡œ **ì´ˆê¸°í™”ëœ ë©”ëª¨ë¦¬ ë¸”ë¡**ì„ í• ë‹¹ |
  | `realloc()`      | ê¸°ì¡´ ë©”ëª¨ë¦¬ì˜ í¬ê¸°ë¥¼ **ë³€ê²½(ì¬í• ë‹¹)** |
  | `reallocarray()` | `realloc()`ì˜ ì•ˆì „ ë²„ì „ (ì˜¤ë²„í”Œë¡œìš° ë°©ì§€) |
  | `aligned_alloc()`| **ì§€ì •í•œ ì •ë ¬ ë‹¨ìœ„**ë¡œ ë©”ëª¨ë¦¬ í• ë‹¹ |
  | `free()`         | `malloc()` ë“±ìœ¼ë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬ë¥¼ **í•´ì œ** |


  ### `void *malloc(size_t size)`

  - `size` ë°”ì´íŠ¸ë§Œí¼ì˜ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ **í™ì—ì„œ í• ë‹¹**
  - ë°˜í™˜ëœ í¬ì¸í„°ëŠ” `void*`ì´ë¯€ë¡œ ì ì ˆí•œ í˜•ìœ¼ë¡œ **ìºìŠ¤íŒ…**í•˜ì—¬ ì‚¬ìš©
  - **ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ â†’ ì“°ê¸° ì „ì— ë°˜ë“œì‹œ ì´ˆê¸°í™” í•„ìš”**
  - ì´ì‹ì„±ì„ ìœ„í•´ ê°œì²´ì˜ í¬ê¸°ë¥¼ ê³„ì‚°ì‹œ sizeof ì—°ì‚°ì ì‚¬ìš©
  - ë°˜í™˜ê°’ : NULL í¬ì¸í„° or í• ë‹¹ëœ ê³µê°„ì— ëŒ€í•œ í¬ì¸í„°

  ğŸ”¹ ì˜ˆ:
  ```c
  typedef struct
  {
    char c[10];
    int i;
    double d;
  }widgetí„°í„°

  widget *arr = malloc(sizeof(widget)); // í˜•ì‹ì´ ëª…í™•í•˜ê²Œ ì •í•´ì§, ì—­ì°¸ì¡°ë‚˜ ë©¤ë²„ ì ‘ê·¼ ê°€ëŠ¥, ì•”ì‹œì  í˜•ë³€í™˜

  if(arr == NULL){
    // í• ë‹¹ ì˜¤ë¥˜ ì²˜ë¦¬
  }
  ```

  ### í˜•ì‹ì„ ì„ ì–¸í•˜ì§€ ì•Šê³  ë©”ëª¨ë¦¬ í• ë‹¹
  ```c
  void *p1 = malloc(sizeof(widget);  // í˜•ì‹ ì—†ëŠ” ì €ì¥ì†Œ(raw storage), ì—­ì°¸ì¡°ë‚˜ ë©¤ë²„ ì ‘ê·¼ ë¶ˆê°€->í˜•ë³€í™˜ í›„ ì‚¬ìš©í•´ì•¼í•¨, p1ì€ ìµœì†Œ 8ë°”ì´íŠ¸ ì •ë ¬ëœ í¬ì¸í„°
  char *p2 = malloc(sizeof(widget));  // í˜•ì‹ ì—†ëŠ” ì €ì¥ì†Œ(raw storage), ìœ íš¨í•œ í˜•ì‹ ê°œì²´ ì•„ë‹˜, ë¨ë¨ì´íŠ¸ ë°°ì—´ì²˜ëŸ¼ ì‚¬ìš©ì€ ê°€ëŠ¥
  // p1->i ì ‘ê·¼ ì•ˆë¨, p1[1]ì€ ê°€ëŠ¥
  
  widget w = {"abc", 9, 3.2};
  memcpy(p1, &w, sizeof(widget)); // ê°œì²´ ë³µì‚¬ -> í˜•ì‹ ë¶€ì—¬, p1ì€ ì´ë•Œ ìœ íš¨í•œ í˜•ì‹ì„ ê°€ì§
  printf("p.i = %d\n", p -> i);
  ```
  - í• ë‹¹ëœ ì €ì¥ì†ŒëŠ” ê°œì²´ê°€ ë³µì‚¬ë˜ê¸° ì „ê¹Œì§€ëŠ” ìœ íš¨í•œ í˜•ì‹ì„ ê°–ì§€ ì•ŠìŒ, ì–´ë–¤ í˜•ì‹ì˜ ê°œì²´ê°€ ë³µì‚¬ë˜ë©´, ê·¸ ì €ì¥ì†ŒëŠ” ì´ì œ ê·¸ í˜•ì‹ì˜ ìœ íš¨í•œ ê°œì²´ë¥¼ ê°–ê²Œë¨
  - ìµœëŒ€ ì •ë ¬ ë‹¨ìœ„ë¥¼ ë§Œì¡±í•˜ë„ë¡ ì •ë ¬ëœ í¬ì¸í„°ë¥¼ ë°˜í™˜ -> ì–´ë–¤ íƒ€ì…ì´ë“  ë³µì‚¬í•´ì„œ ë„£ì–´ë„ ì •ë ¬ ìœ„ë°˜ì´ ë°œìƒ x

  ### í¬ì¸í„°ë¥¼ ì„ ì–¸ëœ ê°œì²´ì˜ í˜•ì‹ìœ¼ë¡œ ìºìŠ¤íŒ…í•˜ê¸°  
  ```c
  widget *p = (widget *)malloc(sizeof(widget));
  ```
  - cì—ì„œ ìºìŠ¤íŒ… í•  í•„ìš” ì—†ìŒ, c++ì—ì„œ í•„ìˆ˜
 

  ```c
  widget *p = (widget *)malloc(sizeof(widgett));  // â† ì˜¤íƒ€!
  ```

  - `widgett`ë¼ëŠ” íƒ€ì…ì´ **ì—†ëŠ”ë°ë„ ì»´íŒŒì¼ì€ í†µê³¼**
  - â†’ `sizeof(widgett)`ëŠ” 0ì´ ë˜ê³ , `malloc(0)` ìˆ˜í–‰ë¨ â†’ **ëŸ°íƒ€ì„ ë²„ê·¸ ë°œìƒ ê°€ëŠ¥**


  ```c
  widget *p = malloc(sizeof(widgett));  // âŒ ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ â†’ ì˜¤íƒ€ë¥¼ ì¡ì•„ì¤Œ
  ```
  - **í˜•ë³€í™˜ì„ ìƒëµí•˜ë©´ ì»´íŒŒì¼ëŸ¬ê°€ íƒ€ì… ì²´í¬ë¥¼ í•´ì¤ë‹ˆë‹¤.**
  - CERT Cì—ì„œ ìºìŠ¤íŒ… ìš”êµ¬ í•˜ì§€ ì•ŠìŒ


  ### ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ ì½ê¸°(Uninitialized Memory Read, UMR)

  > í”„ë¡œê·¸ë¨ì´ **ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ë³€ìˆ˜ë‚˜ ë©”ëª¨ë¦¬ ì˜ì—­**ì„ ì½ìœ¼ë ¤ê³  í•  ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜.  

  > ì´ ê°’ì€ **ì“°ë ˆê¸° ê°’(garbage value)**ì´ë©°, ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ë™ì‘ì„ ì¼ìœ¼í‚µë‹ˆë‹¤.

  > **ì •ì˜ë˜ì§€ ì•Šì€ ë™ì‘(undefined behavior)**
  ```c
  #include <stdlib.h>
  #include <stdio.h>

  int main() {
      int *arr = malloc(5 * sizeof(int));
      printf("%d\n", arr[2]);  // âŒ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ í™ ë©”ëª¨ë¦¬ ì½ê¸°
      free(arr);
      return 0;
  }
  ```
  - `malloc()`ì€ **ì´ˆê¸°í™”í•˜ì§€ ì•Šê³ ** ê·¸ëƒ¥ ë©”ëª¨ë¦¬ ë¸”ë¡ë§Œ í™•ë³´í•¨
  - **`arr[2]`ì—ëŠ” ì“°ë ˆê¸° ê°’ì´ ë“¤ì–´ ìˆìŒ**
  - ì •ì˜ë˜ì§€ ì•Šì€ ë™ì‘
  ```c
  #include <stdio.h>
  #include <stdlib.h>
  #include <string.h>

  int main(void)
  {
    char *str = (char *)(malloc(16));

    if(str)
    {
      strncpy(str, "123456789abcdef", 15);
      printf("str = %s\n",str);
      free(str);
      return EXIT_SUCCESS;
    }
    return EXIT_FAILURE;
  }
  ```
  - str[15]ê°€ 0ìœ¼ë¡œ ì´ˆê¸°í™” ë ê±°ë¼ê³  ìƒê°í•˜ì§€ë§Œ ê·¸ë ‡ì§€ ì•ŠìŒ
  - str[15]ëŠ” nullì¼ìˆ˜ë„ ì“°ë ˆê¸° ê°’ì¼ìˆ˜ë„ ìˆìŒ -> printfì—ì„œ ì •ì˜ ë˜ì§€ ì•Šì€ ë™ì‘ ë°œìƒ

  ### `void *aligned_alloc(size_t alignment, size_t size)`

  - **ì •ë ¬ëœ ë©”ëª¨ë¦¬**ë¥¼ ìš”ì²­í•  ë•Œ ì‚¬ìš© (ex. 16, 32, 64ë°”ì´íŠ¸ ê²½ê³„)
  - `alignment`ì€ **2ì˜ ê±°ë“­ì œê³±**ì´ì–´ì•¼ í•˜ë©°, `size`ëŠ” `alignment`ì˜ **ë°°ìˆ˜**ì—¬ì•¼ í•¨
  - SIMD (SSE, AVX), DMA ë“±ì— ìœ ìš©
  - êµ¬í˜„ì²´ ì§€ì›í•˜ëŠ” ìœ íš¨í•œ ë§ì¶¤ì´ ì•„ë‹Œ ê²½ìš° null í¬ì¸í„° ë°˜í™˜

  ğŸ”¹ ì˜ˆ:
  ```c
  #include <stdlib.h>
  float *vec = aligned_alloc(32, 8 * sizeof(float)); // 32ë°”ì´íŠ¸ ì •ë ¬ëœ 32B ë©”ëª¨ë¦¬
  ```

  ### `void *calloc(size_t nmemb, size_t size)`

  - `nmemb` ê°œì˜ ì›ì†Œë¥¼ ê°ê° `size` ë°”ì´íŠ¸ë¡œ í• ë‹¹
  - ëª¨ë“  ë°”ì´íŠ¸ë¥¼ **0ìœ¼ë¡œ ì´ˆê¸°í™”**
  - `malloc()` + `memset()`ì„ ê²°í•©í•œ íš¨ê³¼
  ğŸ”¹ ì˜ˆ:
  ```c
  int *arr = calloc(10, sizeof(int));  // 10ê°œ int 0ìœ¼ë¡œ ì´ˆê¸°í™”
  ```

  ### `void *realloc(void *ptr, size_t new_size)`

  - ê¸°ì¡´ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ `new_size` í¬ê¸°ë¡œ **ì¬í• ë‹¹**
  - ë™ì‘
    - ê¸°ì¡´ í¬ì¸í„° `ptr`ì˜ ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ ëŠ˜ë¦¬ê±°ë‚˜ ì¤„ì„
    - ìƒˆë¡œìš´ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ í• ë‹¹ í•œ í›„ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ê³  ì›ë˜ ë¸”ë¡ì„ í•´ì œ
    - ë°˜í™˜ê°’ì€ ìƒˆ ë¸”ë¡ì˜ í¬ì¸í„°
    - NULL ë°˜í™˜ ì‹œ ì¬í• ë‹¹ ì‹¤íŒ¨, ì›ë˜ í¬ì¸í„°ëŠ” ìœ ì§€ë¨ ë”°ë¼ì„œ freeë¥¼ ëª…ì‹œì ìœ¼ë¡œ í•´ì¤˜ì•¼í•¨
    - `realloc(NULL, size)` â†’ `malloc(size)`ì™€ ë™ì¼í• ë‹¹
    - ìƒˆ ìŠ¤í† ë¦¬ì§€ê°€ ë” í¬ë‹¤ë©´ ì¶”ê°€ ìŠ¤í† ë¦¬ì§€ëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ë‚¨ê¹€
  - new_size = 0 ì¼ ê²½ìš° ì •ì˜ ë˜ì§€ ì•Šì€ ë™ì‘
  ```c
  p = realloc(p, nsize);  // âŒ realloc ì‹¤íŒ¨ ì‹œ pëŠ” NULLë¡œ ë®ì—¬ì§ â†’ ê¸°ì¡´ ë©”ëª¨ë¦¬ ìƒì–´ë²„ë¦¼
  ```
  - ì˜¬ë°”ë¥¸ ë°©ë²•
  ```c
  void *p2; // ì„ì‹œ í¬ì¸í„° ì‚¬ìš©
  void *p = malloc(100);

  if((nsize == 0) || (p2 = realloc(p, nsize)) == NULL)  // NULL ë°˜í™˜ê°’ì´ ë®íˆì§€ ì•Šë„ë¡ p2ë¡œ ëŒ€ì…, nsize == 0ì˜ ì •ì˜ë˜ì§€ ì•Šì€ ë™ì‘ í…ŒìŠ¤íŠ¸ 
  {
    free(p);
    return NULL;
  }
  p = p2; // ìƒˆë¡œ ì¬ í• ë‹¹ëœ ë©”ëª¨ë¦¬ì˜ í¬ì¸í„°ë¥¼ ëŒ€ì…
  ```

  ### `void *reallocarray(void *ptr, size_t nmemb, size_t size)`

  - `realloc()`ì—ì„œ  `nmemb * size` ì—°ì‚°ì—ì„œ size_tì˜ **ì˜¤ë²„í”Œë¡œìš°ë¥¼ ë°œìƒì‹œ** ì •ì˜ë˜ì§€ ì•ŠëŠ” ë™ì‘ ë°œìƒ
  - num*sizeì˜ ê°’ì´ ì˜¤ë²„í”Œë¡œìš°ê°€ ë  ê²½ìš° NULL í¬ì¸í„°ë¥¼ ë°˜í™˜ 
  - ì£¼ë¡œ **ë³´ì•ˆì´ ì¤‘ìš”í•œ ì½”ë“œì—ì„œ ì‚¬ìš©**ë¨ (ì˜ˆ: OpenBSD)

  ğŸ”¹ ì˜ˆ:
  ```c
  int *arr = reallocarray(NULL, 1000, sizeof(int)); // == calloc(1000, sizeof(int))ê³¼ ìœ ì‚¬
  ```

  ### `void free(void *ptr)`
  - `malloc()`, `calloc()`, `realloc()` ë“±ìœ¼ë¡œ **í• ë‹¹í•œ ë©”ëª¨ë¦¬ í•´ì œ**
  - ì¸ìë¡œ ì „ë‹¬ëœ í¬ì¸í„°ëŠ” ì´í›„ **ì‚¬ìš© ê¸ˆì§€**
  - `NULL`ì„ ì „ë‹¬í•˜ë©´ ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•ŠìŒ

  ### dangling pointer ë°©ì§€
  - ì´ë¯¸ í•´ì œëœ ë©”ëª¨ë¦¬ì— ëŒ€í•œ í¬ì¸í„°
  ```c
  free(arr);
  arr = NULL;  // Dangling pointer ë°©ì§€
  ```

  ### double-free ì·¨ì•½ì  ë°©ì§€
  > ê°™ì€ í¬ì¸í„°ì— ëŒ€í•œ ë‘ë²ˆ ì´ìƒì˜ free()í˜¸ì¶œ -> ì •ì˜ë˜ì§€ ì•ŠëŠ” ë™ì‘
  ```c
  void *p = malloc(100);
  free(p);
  free(p);  // âŒ ë‘ ë²ˆì§¸ í•´ì œ â†’ double free
  ```
  - ì´ë¯¸ í•´ì œëœ ë©”ëª¨ë¦¬ë¥¼ ë‹¤ì‹œ í•´ì œí•˜ë ¤ê³  í•˜ë©´, **í™ ê´€ë¦¬ì(ë©”ëª¨ë¦¬ ê´€ë¦¬ì)ì˜ ë‚´ë¶€ êµ¬ì¡°ê°€ ì†ìƒ**

  í™ êµ¬ì¡°ê°€ ì†ìƒë¨
  - ë§ì€ ë©”ëª¨ë¦¬ ê´€ë¦¬ìëŠ” freeëœ ë¸”ë¡ì„ **freelist** ë˜ëŠ” **bin**ì— ë„£ì–´ ê´€ë¦¬
  - ë‘ ë²ˆ ë„£ìœ¼ë©´ **ë§í¬ê°€ ê¼¬ì´ê±°ë‚˜**, **ì›ë˜ ìœ„ì¹˜ì— ë‹¤ë¥¸ ì½”ë“œê°€ ì“¸ ìˆ˜ ìˆëŠ” í¬ì¸í„°ê°€ ë“¤ì–´ê°**
  - ì´ë¥¼ ì•…ìš©í•´ **ë©”ëª¨ë¦¬ ë®ì–´ì“°ê¸°, ì„ì˜ ì½”ë“œ ì‹¤í–‰** ê°€ëŠ¥
  - ê³µê²©ìê°€ íŠ¹ì •í•œ `free()` ì‹œì ì„ ì¡°ì‘í•˜ì—¬,  **ì›ë˜ í”„ë¡œê·¸ë¨ ë¡œì§ì„ ë²—ì–´ë‚œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹ë°›ê²Œ í•  ìˆ˜ ìˆìŒ**
  - ì´í›„ **í•¨ìˆ˜ í¬ì¸í„°, GOT, vtable** ê°™ì€ ë¯¼ê°í•œ ë©”ëª¨ë¦¬ êµ¬ì¡°ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆìŒ

  | ë°©ë²•                      | ì„¤ëª… |
  |---------------------------|------|
  | `free()` í›„ í¬ì¸í„°ë¥¼ NULLë¡œ ì´ˆê¸°í™” | `free(p); p = NULL;` í•˜ë©´ double free ë°©ì§€ |
  | ë©”ëª¨ë¦¬ ìƒíƒœ ì¶”ì  ë„êµ¬ ì‚¬ìš©     | `valgrind`, `asan` ë“±ìœ¼ë¡œ double free íƒì§€ |
  | ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°(C++) ì‚¬ìš©        | `unique_ptr` ë“±ì€ ìë™ìœ¼ë¡œ í•œ ë²ˆë§Œ í•´ì œ |
  | ì»¤ìŠ¤í…€ ë©”ëª¨ë¦¬ í’€ ì‚¬ìš©           | ì‚¬ìš©ì ì •ì˜ í• ë‹¹ê¸°ì—ì„œ ì´ì¤‘ í•´ì œ ê°ì§€ ê°€ëŠ¥ |

  ```c
  void *p = malloc(100);
  // ...
  free(p);
  p = NULL;  // âœ… ì´í›„ ì‹¤ìˆ˜ë¡œ ë‹¤ì‹œ free(p) í•´ë„ ì•„ë¬´ ì¼ ì—†ìŒ
  ```

## ìœ ì—°í•œ ë°°ì—´ ë©¤ë²„

- **ìœ ì—°í•œ ë°°ì—´ ë©¤ë²„(Flexible Array Member, FAM)**ë¥¼ í¬í•¨í•œ êµ¬ì¡°ì²´ë¥¼ **ë™ì ìœ¼ë¡œ í• ë‹¹í•˜ê³  ë³µì‚¬í•˜ëŠ” ë°©ë²•**

  ### âœ… ìœ ì—°í•œ ë°°ì—´ ë©¤ë²„ë€?

  C99ë¶€í„° ë„ì…ëœ ê¸°ëŠ¥ìœ¼ë¡œ,  
  êµ¬ì¡°ì²´ ë§ˆì§€ë§‰ ë©¤ë²„ë¥¼ í¬ê¸° ì—†ëŠ” ë°°ì—´ë¡œ ì„ ì–¸í•˜ë©´  
  **ë™ì ìœ¼ë¡œ ìœ ì—°í•œ í¬ê¸°ì˜ ë°ì´í„°ë¥¼ ë¶™ì¼ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.**

  ```c
  typedef struct {
      size_t len;
      char data[];  // ìœ ì—°í•œ ë°°ì—´ ë©¤ë²„ (FAM)
  } Buffer;
  ```

  - `data[]`ëŠ” í¬ê¸°ê°€ ì •í•´ì§€ì§€ ì•Šì•˜ì§€ë§Œ,
  - `malloc()`ìœ¼ë¡œ ì „ì²´ êµ¬ì¡°ì²´ í¬ê¸° + í•„ìš”í•œ ë°°ì—´ í¬ê¸°ë§Œí¼ **í•œêº¼ë²ˆì— í• ë‹¹**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



  ### 1. ë™ì  í• ë‹¹ ë°©ë²•

  ```c
  size_t len = 100;
  Buffer *buf = malloc(sizeof(Buffer) + len * sizeof(char));
  buf->len = len;
  memcpy(buf->data, "hello", 6);
  ```

  - `sizeof(Buffer)`ëŠ” `len` í•„ë“œê¹Œì§€ë§Œ í¬í•¨  
  - `data[]`ëŠ” `malloc`ìœ¼ë¡œ ì¶”ê°€ ê³µê°„ì„ í™•ë³´í•´ì•¼ ì‚¬ìš© ê°€ëŠ¥


  ### 2. ë³µì‚¬í•˜ê¸°

  ë³µì‚¬í•˜ë ¤ë©´ **ì „ì²´ êµ¬ì¡°ì²´ í¬ê¸° + ë°°ì—´ í¬ê¸°**ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

  ```c
  size_t size = sizeof(Buffer) + buf->len * sizeof(char);
  Buffer *copy = malloc(size);
  memcpy(copy, buf, size);
  ```

  - `memcpy()`ëŠ” êµ¬ì¡°ì²´ í•„ë“œì™€ ë°°ì—´ ì „ì²´ë¥¼ **ë©”ëª¨ë¦¬ í†µì§¸ë¡œ ë³µì‚¬**
  - `copy->len`ê³¼ `copy->data`ë„ ë™ì¼í•˜ê²Œ ìœ ì§€ë¨

  ### ì˜ˆì œ ì „ì²´ ì½”ë“œ

  ```c
  #include <stdio.h>
  #include <stdlib.h>
  #include <string.h>

  typedef struct {
      size_t len;
      char data[];
  } Buffer;

  int main() {
      const char *msg = "Hello, FAM!";
      size_t len = strlen(msg) + 1;

      // 1. ë™ì  í• ë‹¹
      Buffer *buf = malloc(sizeof(Buffer) + len);
      buf->len = len;
      memcpy(buf->data, msg, len);

      // 2. ë³µì‚¬
      size_t total_size = sizeof(Buffer) + buf->len;
      Buffer *copy = malloc(total_size);
      memcpy(copy, buf, total_size);

      // í™•ì¸
      printf("ë³µì‚¬ë³¸: %s\n", copy->data);

      // í•´ì œ
      free(buf);
      free(copy);
      return 0;
  }
  ```


## ê°€ë³€ ê¸¸ì´ ë°°ì—´
**ê°€ë³€ ê¸¸ì´ ë°°ì—´ (VLA: Variable Length Array)** 

> ğŸ”¹ ë°°ì—´ì˜ í¬ê¸°ë¥¼ **ì»´íŒŒì¼ íƒ€ì„ì´ ì•„ë‹Œ ëŸ°íƒ€ì„**ì— ì •í•  ìˆ˜ ìˆëŠ” ë°°ì—´  
> ğŸ”¹ C99ë¶€í„° ë„ì…ëœ **ìŠ¤íƒ ê¸°ë°˜ ë™ì  ë°°ì—´**  
> ğŸ”¹ ì„ ì–¸ ì‹œ `malloc()`ì²˜ëŸ¼ ëª…ì‹œì  í• ë‹¹ ì—†ì´  
>    **ë³€ìˆ˜ë¡œ ë°°ì—´ í¬ê¸°ë¥¼ ì§€ì •**í•  ìˆ˜ ìˆìŒ

  ### âœ… ì˜ˆì œ

  ```c
  #include <stdio.h>

  void foo(int n) {
      int arr[n];  // â† VLA: ê¸¸ì´ê°€ nì¸ ë°°ì—´, í¬ê¸°ëŠ” ëŸ°íƒ€ì„ì— ê²°ì •ë¨

      for (int i = 0; i < n; i++)
          arr[i] = i * 10;

      for (int i = 0; i < n; i++)
          printf("%d ", arr[i]);
      printf("\n");
  }

  int main() {
      foo(5);   // ì¶œë ¥: 0 10 20 30 40
      return 0;
  }
  ```

  ### âœ… ì£¼ìš” íŠ¹ì§•

  | í•­ëª© | ì„¤ëª… |
  |------|------|
  | ë©”ëª¨ë¦¬ ìœ„ì¹˜ | **ìŠ¤íƒ(stack)** |
  | ìˆ˜ëª… | ë°°ì—´ì´ ì„ ì–¸ëœ **ë¸”ë¡(scope)** ì•ˆì—ì„œë§Œ |
  | í¬ê¸° ê²°ì • | **ëŸ°íƒ€ì„**ì— ì •í•´ì§ |
  | íƒ€ì… | ë°°ì—´ ìì²´ (í¬ì¸í„° ì•„ë‹˜!) |
  | ì ‘ê·¼ ë°©ì‹ | `arr[i]` â€” ì¼ë°˜ ë°°ì—´ì²˜ëŸ¼ |
  | í•´ì œ í•„ìš” | âŒ í•„ìš” ì—†ìŒ (ìë™ í•´ì œë¨) |


  ### âœ… VLA vs `malloc()` vs ì •ì  ë°°ì—´

  | í•­ëª© | VLA (`int arr[n]`) | malloc (`int *arr = malloc(...)`) | ì •ì  ë°°ì—´ (`int arr[10]`) |
  |------|---------------------|------------------------------------|----------------------------|
  | ë©”ëª¨ë¦¬ | ìŠ¤íƒ | í™ | ìŠ¤íƒ |
  | ê¸¸ì´ ê²°ì • | ëŸ°íƒ€ì„ | ëŸ°íƒ€ì„ | ì»´íŒŒì¼ íƒ€ì„ |
  | í•´ì œ í•„ìš” | âŒ | âœ… `free()` | âŒ |
  | í¬ì¸í„° ì—¬ë¶€ | âŒ (ì§„ì§œ ë°°ì—´) | âœ… | âŒ |
  | ì†ë„ | ë§¤ìš° ë¹ ë¦„ | ëŠë¦¼ | ë§¤ìš° ë¹ ë¦„ |


  ### âœ… ì œí•œ ì‚¬í•­

  | ì£¼ì˜í•  ì  | ì„¤ëª… |
  |-----------|------|
  | ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ìœ„í—˜ | ë„ˆë¬´ í° í¬ê¸° í• ë‹¹ ì‹œ ìœ„í—˜ (`int arr[1000000];`)  
  | í¬ê¸°ê°€ 0ì´ë©´? | GCC ë“± ì¼ë¶€ëŠ” í—ˆìš©, í‘œì¤€ì€ ë¯¸ì •ì˜ ë™ì‘  
  | sizeof ì—°ì‚° | ì»´íŒŒì¼ íƒ€ì„ ìƒìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ `sizeof(arr)`ëŠ” ìƒìˆ˜ ì•„ë‹˜  
  | ì´ˆê¸°í™” ë¶ˆê°€ëŠ¥ | `int arr[n] = {1,2,3};` âŒ ì˜¤ë¥˜


  ### âœ… ì˜ˆì œ: `sizeof`ì—ì„œ ì£¼ì˜
  - ëŸ°íƒ€ì„ì— í‰ê°€
  ```c
  void bar(int n) {
      int arr[n];
      printf("%lu\n", sizeof(arr)); // ëŸ°íƒ€ì„ ê²°ê³¼ â†’ n * sizeof(int)
  }
  ```

  ### âœ… í•¨ìˆ˜ ì¸ìë¡œ VLA ë°›ê¸°

  ```c
  #include <stdio.h>

  void print_matrix(int rows, int cols, int matrix[rows][cols]) {
      for (int i = 0; i < rows; i++) {
          for (int j = 0; j < cols; j++) {
              printf("%3d ", matrix[i][j]);
          }
          printf("\n");
      }
  }

  int main() {
      int r = 3, c = 4;
      int mat[r][c];  // VLA

      // ê°’ ì´ˆê¸°í™”
      for (int i = 0, val = 1; i < r; i++)
          for (int j = 0; j < c; j++)
              mat[i][j] = val++;

      print_matrix(r, c, mat);  // âœ… OK
      return 0;
  }
  ```

  ```c
  matrix:
  +----+----+----+----+
  |  1 |  2 |  3 |  4 |   â† matrix[0]
  +----+----+----+----+
  |  5 |  6 |  7 |  8 |   â† matrix[1]
  +----+----+----+----+
  |  9 | 10 | 11 | 12 |   â† matrix[2]
  +----+----+----+----+

  matrix == &matrix[0]
  matrix[i][j] == *(*(matrix + i) + j)
  ```

  ## âœ… 5. sizeofë¡œ í™•ì¸

  ```c
  void test(int rows, int cols, int matrix[rows][cols]) {
      printf("sizeof(matrix) = %lu\n", sizeof(matrix));        // í¬ì¸í„° â†’ 8 (64bit)
      printf("sizeof(matrix[0]) = %lu\n", sizeof(matrix[0]));  // í•œ í–‰ â†’ cols * 4
      printf("sizeof(matrix[0][0]) = %lu\n", sizeof(matrix[0][0])); // int â†’ 4
  }
  ```

  âŒ `void foo(int arr[][])` â†’ **ì»´íŒŒì¼ ì—ëŸ¬**  
  â†’ **ë‘ ë²ˆì§¸ ì´í›„ ì°¨ì›ì˜ í¬ê¸°ëŠ” ë°˜ë“œì‹œ ëª…ì‹œí•´ì•¼ í•¨**

  âœ… `void foo(int rows, int cols, int arr[][cols])`  
  âœ… `void foo(int (*arr)[cols])`


 

